<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마법의 변신 물약</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden; /* Prevent scrollbars due to full-screen background */
        }
        /* Tailwind CSS filter for glow effect */
        .item-glow {
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.9));
        }
    </style>
</head>
<body>
    <div id="app-root" class="font-sans"></div>

    <script>
        // --- 게임 데이터 설정 ---
        // 이곳에서 게임에 사용될 아이템들의 정보를 수정할 수 있습니다.
        // 사용자의 이미지 URL로 교체해주세요.
        const itemsData = {
            decoration: [
                { id: 'deco1', name: '반짝이는 눈동자', image: '/bon.png' },
                { id: 'deco2', name: '신비로운 눈동자', image: '/yon.png' },
                { id: 'deco3', name: '따뜻한 눈동자', image: '/ron.png' },
            ],
            flavor: [
                { id: 'flavor1', name: '달콤한 딸기 시럽', image: '/bhu.png' },
                { id: 'flavor2', name: '상큼한 포도 시럽', image: '/phu.png' },
                { id: 'flavor3', name: '새콤한 레몬 시럽', image: '/yhu.png' },
            ],
            magic: [
                { id: 'magic1', name: '별의 조각', image: '/bst.png' },
                { id: 'magic2', name: '달의 눈물', image: '/gst.png' },
                { id: 'magic3', name: '구름의 솜털', image: '/pst.png' },
            ],
        };

        // --- 결과 데이터 설정 ---
        // 아이템 조합에 따른 결과 이미지입니다.
        const resultsMap = {
            'deco1_flavor1_magic1': { name: '상냥한 요정', image: '/meme1.png' },
            'deco1_flavor1_magic2': { name: '수줍은 요정', image: '/meme2.png' },
            'deco1_flavor1_magic3': { name: '장난꾸러기 요정', image: '/meme3.png' },
            'deco1_flavor2_magic1': { name: '신비로운 마법사', image: '/meme4.png' },
            'deco1_flavor2_magic2': { name: '꿈꾸는 마법사', image: '/meme5.png' },
            'deco1_flavor2_magic3': { name: '현명한 마법사', image: '/meme6.png' },
            'deco1_flavor3_magic1': { name: '호기심 많은 탐험가', image: '/meme7.png' },
            'deco1_flavor3_magic2': { name: '용감한 탐험가', image: '/meme8.png' },
            'deco1_flavor3_magic3': { name: '자유로운 탐험가', image: '/meme9.png' },

            'deco2_flavor1_magic1': { name: '활발한 모험가', image: '/meme10.png' },
            'deco2_flavor1_magic2': { name: '겁 없는 모험가', image: '/meme11.png' },
            'deco2_flavor1_magic3': { name: '재치있는 모험가', image: '/meme12.png' },
            'deco2_flavor2_magic1': { name: '신비로운 정령', image: '/meme13.png' },
            'deco2_flavor2_magic2': { name: '숲의 정령', image: '/meme14.png' },
            'deco2_flavor2_magic3': { name: '물의 정령', image: '/meme15.png' },
            'deco2_flavor3_magic1': { name: '명랑한 요정', image: '/meme16.png' },
            'deco2_flavor3_magic2': { name: '밝은 요정', image: '/meme17.png' },
            'deco2_flavor3_magic3': { name: '행복한 요정', image: '/meme18.png' },

            'deco3_flavor1_magic1': { name: '지혜로운 현자', image: '/meme19.png' },
            'deco3_flavor1_magic2': { name: '고독한 현자', image: '/meme20.png' },
            'deco3_flavor1_magic3': { name: '인내심 강한 현자', image: '/meme21.png' },
            'deco3_flavor2_magic1': { name: '장난스러운 악마', image: '/meme22.png' },
            'deco3_flavor2_magic2': { name: '교활한 악마', image: '/meme23.png' },
            'deco3_flavor2_magic3': { name: '강력한 악마', image: '/meme24.png' },
            'deco3_flavor3_magic1': { name: '어둠의 그림자', image: '/meme25.png' },
            'deco3_flavor3_magic2': { name: '밤의 지배자', image: '/meme26.png' },
            'deco3_flavor3_magic3': { name: '심연의 존재', image: '/meme27.png' },
            'default': { name: '평범한 모습', image: '/meme1.png' }
        };

        // --- 스타일 클래스 설정 ---
        const styles = {
            button: "px-8 py-4 bg-pink-400 text-white font-bold rounded-full shadow-lg transform hover:scale-105 hover:bg-pink-500 transition-all duration-300 text-2xl",
            container: "w-full min-h-screen bg-cover bg-center flex flex-col items-center justify-center p-8",
            itemGlow: "filter drop-shadow-[0_0_15px_rgba(255,255,255,0.9)]",
        };

        // --- 전역 상태 관리 ---
        let gameState = 'menu'; // 'menu', 'howToPlay', 'playing', 'result'
        let selectedItems = { decoration: null, flavor: null, magic: null };
        let lastClickedItem = null;
        let resultKey = null;
        let currentMessage = null; // For modal message

        const appRoot = document.getElementById('app-root');

        // --- 메시지 모달 함수 ---
        function showMessage(msg, callback = () => {}) {
            currentMessage = { text: msg, callback: callback };
            renderMessageModal();
        }

        function closeMessage() {
            if (currentMessage && currentMessage.callback) {
                currentMessage.callback();
            }
            currentMessage = null;
            renderMessageModal(); // Clear the modal
        }

        function renderMessageModal() {
            const existingModal = document.getElementById('message-modal');
            if (existingModal) {
                existingModal.remove();
            }

            if (!currentMessage) {
                return;
            }

            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'message-modal';
            modalOverlay.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50';

            const modalContent = document.createElement('div');
            modalContent.className = 'bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm mx-4';

            const messageP = document.createElement('p');
            messageP.className = 'text-xl font-semibold text-gray-800 mb-6';
            messageP.textContent = currentMessage.text;

            const closeButton = document.createElement('button');
            closeButton.className = 'px-6 py-3 bg-pink-500 text-white font-bold rounded-full hover:bg-pink-600 transition-colors';
            closeButton.textContent = '확인';
            closeButton.addEventListener('click', closeMessage);

            modalContent.appendChild(messageP);
            modalContent.appendChild(closeButton);
            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);
        }

        // --- 상태 변경 핸들러 ---
        function handleStateChange(newState, data = null) {
            gameState = newState;
            if (newState === 'result') {
                resultKey = data;
            }
            // Reset selected items when transitioning to playing state
            if (newState === 'playing') {
                selectedItems = { decoration: null, flavor: null, magic: null };
                lastClickedItem = null;
            }
            renderApp(); // Re-render the entire app based on new state
        }

        // --- 메인 메뉴 렌더링 함수 ---
        function renderMainMenu() {
            appRoot.innerHTML = ''; // Clear previous content

            const container = document.createElement('div');
            container.className = styles.container;
            container.style.backgroundImage = "url('/main.png')";

            const contentBox = document.createElement('div');
            contentBox.className = "bg-black bg-opacity-30 p-10 rounded-2xl shadow-2xl text-center";

            const title = document.createElement('h1');
            title.className = "text-6xl font-extrabold text-white mb-12";
            title.style.textShadow = '2px 2px 5px #000';
            title.textContent = '윤정이의 변신 마법';

            const buttonContainer = document.createElement('div');
            buttonContainer.className = "space-y-6";

            const playButton = document.createElement('button');
            playButton.className = styles.button;
            playButton.textContent = '게임하기';
            playButton.addEventListener('click', () => handleStateChange('playing'));

            const howToPlayButton = document.createElement('button');
            howToPlayButton.className = styles.button;
            howToPlayButton.textContent = '게임 방법';
            howToPlayButton.addEventListener('click', () => handleStateChange('howToPlay'));

            const quitButton = document.createElement('button');
            quitButton.className = styles.button;
            quitButton.textContent = '그만하기';
            quitButton.addEventListener('click', () => {
                showMessage('게임을 종료합니다.', () => {
                    // In a real application, you might close the window or navigate away.
                    // For this web app, we'll just go back to the menu.
                    handleStateChange('menu');
                });
            });

            buttonContainer.appendChild(playButton);
            buttonContainer.appendChild(howToPlayButton);
            buttonContainer.appendChild(quitButton);
            contentBox.appendChild(title);
            contentBox.appendChild(buttonContainer);
            container.appendChild(contentBox);
            appRoot.appendChild(container);
        }

        // --- 게임 방법 렌더링 함수 ---
        function renderHowToPlay() {
            appRoot.innerHTML = ''; // Clear previous content

            const container = document.createElement('div');
            container.className = styles.container;
            container.style.backgroundImage = "url('/main.png')";

            const contentBox = document.createElement('div');
            contentBox.className = "bg-white bg-opacity-80 p-10 rounded-2xl shadow-2xl max-w-3xl text-center";

            const title = document.createElement('h2');
            title.className = "text-4xl font-bold text-pink-500 mb-6";
            title.textContent = '게임 방법';

            const description = document.createElement('p');
            description.className = "text-gray-700 text-lg mb-8 leading-relaxed";
            description.innerHTML = `
                마법 솥에 3가지 종류의 재료를 하나씩 넣어 물약을 완성해보세요!<br />
                꾸미기 재료, 맛 재료, 마법 재료를 각각 하나씩 선택해야 합니다.<br />
                어떤 재료를 넣느냐에 따라 다양한 모습으로 변신할 수 있어요.<br />
                27가지의 모든 변신 모습을 찾아보세요!
            `;

            const backButton = document.createElement('button');
            backButton.className = styles.button;
            backButton.textContent = '돌아가기';
            backButton.addEventListener('click', () => handleStateChange('menu'));

            contentBox.appendChild(title);
            contentBox.appendChild(description);
            contentBox.appendChild(backButton);
            container.appendChild(contentBox);
            appRoot.appendChild(container);
        }

        // --- 게임 화면 렌더링 함수 ---
        function renderGameScreen() {
            appRoot.innerHTML = ''; // Clear previous content

            const container = document.createElement('div');
            container.className = styles.container;
            // public 폴더 내의 이미지는 웹 애플리케이션의 루트 경로(/)에서 직접 접근할 수 있습니다.
            container.style.backgroundImage = "url('/meme.png')";

            const backToMenuButtonContainer = document.createElement('div');
            backToMenuButtonContainer.className = "absolute top-4 right-4";
            const backToMenuButton = document.createElement('button');
            backToMenuButton.className = "px-6 py-2 bg-pink-400 text-white font-bold rounded-full shadow-lg hover:bg-pink-500 transition-colors";
            backToMenuButton.textContent = '메인으로';
            backToMenuButton.addEventListener('click', () => handleStateChange('menu'));
            backToMenuButtonContainer.appendChild(backToMenuButton);
            container.appendChild(backToMenuButtonContainer);

            const mainContentArea = document.createElement('div');
            mainContentArea.className = "flex flex-col lg:flex-row gap-8 items-center w-full max-w-6xl";

            // 아이템 선택 영역
            const itemSelectionArea = document.createElement('div');
            itemSelectionArea.className = "w-full lg:w-3/5";

            function createItemCategory(titleText, items, categoryName) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = "mb-6 w-full";

                const title = document.createElement('h3');
                title.className = "text-2xl font-bold text-white mb-3 text-center";
                title.style.textShadow = '1px 1px 2px #000';
                title.textContent = titleText;

                const itemsDiv = document.createElement('div');
                itemsDiv.className = "flex flex-wrap justify-center gap-4 bg-black bg-opacity-20 p-4 rounded-lg";

                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `cursor-pointer transition-transform duration-300 rounded-lg`; // Added rounded-lg here
                    itemDiv.dataset.itemId = item.id; // Store item ID for easy lookup

                    const img = document.createElement('img');
                    img.src = item.image;
                    img.alt = item.name;
                    img.className = "w-24 h-24 object-cover rounded-md";

                    const nameP = document.createElement('p');
                    nameP.className = "text-white text-center text-sm mt-1 font-semibold";
                    nameP.textContent = item.name;

                    itemDiv.appendChild(img);
                    itemDiv.appendChild(nameP);
                    itemsDiv.appendChild(itemDiv);

                    // Event Listeners for item selection and hover
                    itemDiv.addEventListener('click', () => {
                        selectedItems[categoryName] = item;
                        lastClickedItem = item;
                        renderGameScreen(); // Re-render to update selected state and last clicked item
                    });

                    itemDiv.addEventListener('mouseenter', () => {
                        itemDiv.classList.add(styles.itemGlow);
                    });
                    itemDiv.addEventListener('mouseleave', () => {
                        itemDiv.classList.remove(styles.itemGlow);
                    });

                    // Apply selected style if this item is currently selected
                    if (selectedItems[categoryName] && selectedItems[categoryName].id === item.id) {
                        itemDiv.classList.add('transform', 'scale-110', 'border-4', 'border-pink-400');
                    }
                });

                categoryDiv.appendChild(title);
                categoryDiv.appendChild(itemsDiv);
                return categoryDiv;
            }

            itemSelectionArea.appendChild(createItemCategory("꾸미기 재료", itemsData.decoration, "decoration"));
            itemSelectionArea.appendChild(createItemCategory("맛 재료", itemsData.flavor, "flavor"));
            itemSelectionArea.appendChild(createItemCategory("마법 재료", itemsData.magic, "magic"));

            // 중앙 마법솥 및 정보 영역
            const centralArea = document.createElement('div');
            centralArea.className = "w-full lg:w-2/5 flex flex-col items-center";

            const cauldronOuter = document.createElement('div');
            cauldronOuter.className = "w-64 h-64 bg-blue-900 rounded-full border-8 border-purple-500 flex items-center justify-center mb-6";
            const cauldronInner = document.createElement('div');
            cauldronInner.className = "w-52 h-52 bg-cyan-400 rounded-full animate-pulse";
            cauldronOuter.appendChild(cauldronInner);

            const selectedItemInfo = document.createElement('div');
            selectedItemInfo.className = "bg-black bg-opacity-50 text-white p-4 rounded-lg text-center mb-6 min-h-[80px] w-full";
            const infoTitle = document.createElement('p');
            infoTitle.className = "font-semibold";
            infoTitle.textContent = '선택한 아이템:';
            const infoName = document.createElement('p');
            infoName.className = "text-xl text-pink-300";
            infoName.textContent = lastClickedItem ? lastClickedItem.name : '아이템을 선택해주세요.';
            selectedItemInfo.appendChild(infoTitle);
            selectedItemInfo.appendChild(infoName);

            const completeButton = document.createElement('button');
            const isComplete = Object.values(selectedItems).every(item => item !== null);
            completeButton.className = `${styles.button} ${isComplete ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-500 cursor-not-allowed'}`;
            completeButton.disabled = !isComplete;
            completeButton.textContent = isComplete ? '물약 완성!' : '재료를 모두 선택하세요';
            completeButton.addEventListener('click', () => {
                if (isComplete) {
                    const key = `${selectedItems.decoration.id}_${selectedItems.flavor.id}_${selectedItems.magic.id}`;
                    handleStateChange('result', key);
                } else {
                    showMessage('모든 종류의 아이템을 하나씩 선택해주세요!');
                }
            });

            centralArea.appendChild(cauldronOuter);
            centralArea.appendChild(selectedItemInfo);
            centralArea.appendChild(completeButton);

            mainContentArea.appendChild(itemSelectionArea);
            mainContentArea.appendChild(centralArea);
            container.appendChild(mainContentArea);
            appRoot.appendChild(container);
        }

        // --- 결과 화면 렌더링 함수 ---
        function renderResultScreen() {
            appRoot.innerHTML = ''; // Clear previous content

            const result = resultsMap[resultKey] || resultsMap['default'];

            const container = document.createElement('div');
            container.className = styles.container;
            container.style.backgroundImage = "url('final.png')"; // Assume final.png is in the same directory as index.html

            const contentBox = document.createElement('div');
            // Added 'relative' to allow for 'left' positioning relative to its normal flow
            // Added 'transform' and 'left' to shift it 100px left
            contentBox.className = "bg-white bg-opacity-80 p-10 rounded-2xl shadow-2xl text-center flex flex-col items-center relative";
            contentBox.style.left = '-300px'; // Shift 100px to the left

            const title = document.createElement('h2');
            title.className = "text-4xl font-bold text-pink-500 mb-4";
            title.textContent = '변신 성공!';

            const message = document.createElement('p');
            message.className = "text-2xl text-gray-800 mb-6";
            message.innerHTML = `당신은 「${result.name}」(으)로 변신했습니다!`;

            const resultImage = document.createElement('img');
            resultImage.src = result.image;
            resultImage.alt = result.name;
            resultImage.className = "w-80 h-auto object-cover rounded-lg shadow-lg mb-8 border-4 border-pink-300";

            const playAgainButton = document.createElement('button');
            playAgainButton.className = styles.button;
            playAgainButton.textContent = '다시하기';
            playAgainButton.addEventListener('click', () => handleStateChange('playing'));

            contentBox.appendChild(title);
            contentBox.appendChild(message);
            contentBox.appendChild(resultImage);
            contentBox.appendChild(playAgainButton);
            container.appendChild(contentBox);
            appRoot.appendChild(container);
        }

        // --- 메인 앱 렌더링 로직 ---
        function renderApp() {
            switch (gameState) {
                case 'playing':
                    renderGameScreen();
                    break;
                case 'howToPlay':
                    renderHowToPlay();
                    break;
                case 'result':
                    renderResultScreen();
                    break;
                case 'menu':
                default:
                    renderMainMenu();
                    break;
            }
            renderMessageModal(); // Always check and render/remove modal
        }

        // 페이지 로드 시 앱 초기화
        window.onload = renderApp;

    </script>
</body>
</html>
